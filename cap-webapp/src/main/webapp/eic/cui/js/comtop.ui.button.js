;(function($, C){
    /**
     * @class C.UI.Button
     * @extends C.UI.Base
     * ???UI???<br>
     *
     * 1.??????????????????????????????????<br>
     * 2.???????????????????????????<br>
     * 3.????????????????????<br><br>
     * @author ???
     * @version 1.0
     * @history 2012-10-17 ??? ???
     * @demo doc/buttonDoc.html
     */
    C.UI.Button = C.UI.Base.extend({
        options: {
            uitype:'Button',//????????button
            label:'?? ?',//????????????
            hide:false,//???????????????,hidden?????????????????
            disable:false,//??????????????
            icon:'',//???????
            on_click:null,//??????
            menu:null,//???????
            mark:""
        },
        /**
         * ????????????
         */
        _init:function(){
        	this.options.menuId = 'button_' + C.guid();
        },
        /**
         * ???????Ùã??
         */
        _create:function(){
            var opts = this.options;
            if(opts.hide){
                this.hide();
            }
            if(opts.disable){
                this.disable(true);
            }
            if(opts.icon){
                this._setIcon(opts.icon);
            }
            if(opts.menu){
            	if($.isFunction(opts.menu)){//???????????????????§Ù?????????
            		opts.menu = opts.menu();
            	}
            	opts.menu = cui("#" + opts.menuId).menu(opts.menu);//?????????????menu????
            	opts.el.children('div').unbind('click');//??menu????§Ø????¦Ë???????????click???????????
            }
        },
        /**
         * ??????
         * @param {event} e mouseover???
         * @param {dom} eventEl  ????????????DOM????
         * @param {dom} target ????????????????DOM????
         */
        _mouseoverHandler:function(e, eventEl, target){
        	if(this.options.disable)return;
            $(eventEl).addClass('button_box_visited');
        },
        /**
         * ??????
         * @param {event} e mouseout???
         * @param {dom} eventEl  ????????????DOM????
         * @param {dom} target ????????????????DOM????
         */
        _mouseoutHandler:function(e, eventEl, target){
        	if(this.options.disable)return;
            $(eventEl).removeClass('button_box_visited').removeClass('button_box_hover');
        },
        /**
         * ??????
         * @param {event} e mouseup???
         * @param {dom} eventEl  ????????????DOM????
         * @param {dom} target ????????????????DOM????
         */
        _mouseupHandler:function(e, eventEl, target){
        	if(this.options.disable)return;
            $(eventEl).removeClass('button_box_hover');
            $(eventEl).addClass('button_box_visited');
        },
        /**
         * ?????
         * @param {event} e mousedown???
         * @param {dom} eventEl  ????????????DOM????
         * @param {dom} target ????????????????DOM????
         */
        _mousedownHandler:function(e, eventEl, target){
        	if(this.options.disable)return;
            $(eventEl).addClass('button_box_hover');
        },
        /**
         * ??????
         * @param {event} e ??????
         * @param {dom} eventEl  ????????????DOM????
         * @param {dom} target ????????????????DOM????
         */
        _clickHandler:function(e, eventEl, target){
            var opts = this.options;
        	if(opts.disable)return;
        	e.stopPropagation();
        	//??????
        	var objMenu = opts.menu;
        	objMenu && objMenu.show();
        	//??§Ý??????
        	this.options.on_click && this.options.on_click(e,this, opts.mark);
        },
        /**
         * ?????
         * @param {string} icon ????¡¤??
         */
        _setIcon:function(icon){
            var iconUrl;
            if(icon.indexOf('/')!=-1) {
                //???¡¤??
                iconUrl = 'url('+icon+')';
            } else {
                //???????
                iconUrl = 'url(' + this._getIconPath('comtop.ui') + 'themes/default/images/button/'+ icon +')';
            }
            this.options.el.find('.button_icon_container').css('backgroundImage',iconUrl);
        },
        /**
         * ??????????¡¤??,????js?§Ö?????¦Ï????????¦Ë????????????js??¡¤??
         * @return iconPath
         */
        _getIconPath:function(keyWord){
            var $script = $('script');
            var path;
            var reg = new RegExp(keyWord);
            for( var i = 0; i <  $script.length; i++ ){
                path = $script.eq(i).attr('src');
                if( reg.test(path) ){
                    break;
                }
            }
            path = path.substr( 0, path.lastIndexOf('/') );
            path = path.substr( 0, path.lastIndexOf('/') + 1 );
            return path;
        },
         /**
         * ?????????
         * @param {boolean} flag ????????
         **/
         disable:function(flag){
           if(flag == true){
               //this.options.el ???????????§Ø???????????????§Ý????????§µ?el?????¦Ë???dom????
        	   this.options.disable = true;
               this.options.el.children('div').addClass('button_box_disable').removeClass('button_box_visited').removeClass('button_box_hover');
               if(this.options.menu){
            	   this.options.menu.hide && this.options.menu.hide();
               }
           }else{
        	   this.options.disable = false;
               this.options.el.children('div').removeClass('button_box_disable');
           }
        },
        /**
         * ?????????
         **/
        hide:function(){
        	this.options.el.hide();
        	this.options.menu && this.options.menu.hide && this.options.menu.hide();
        },

        /**
         * ?????label
         * @param label {String} ???????
         */
        setLabel:function(label){
            var type = typeof label;
            if(type === 'number' || type === 'string'){
                this.options.label = label;
                $('.button_text_container', this.options.el).html(label)
            }
        }
    })
})(window.comtop.cQuery, window.comtop);