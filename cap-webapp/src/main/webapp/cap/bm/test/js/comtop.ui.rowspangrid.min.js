!function(t){"use strict";var i=t.cQuery;t.UI.RowSpanGrid=t.UI.Base.extend({options:{uitype:"RowSpanGrid",gridwidth:"600px",gridheight:"500px",tablewidth:"",primarykey:"ID",ellipsis:!0,titleellipsis:!0,adaptive:!0,titlelock:!0,oddevenrow:!1,selectrows:"multi",checkboxname:"idList",allboxname:"allbox",datasource:null,titlerender:null,colhidden:!0,colmove:!1,loadtip:!0,resizeheight:null,resizewidth:null,colstylerender:null,colrender:null,pageno:1,pagesize:50,pagesize_list:[25,50,100],pagination:!0,pagination_model:"pagination_min_1",rowclick_callback:null,loadcomplate_callback:null,selectall_callback:null,rowdblclick_callback:null,render_span:!0},format_fn:{date:t.Date.simpleformat,money:t.Number.money},render_method:{a:function(t,i,e){var s=["<a"],h=i.params,a="";if(h){h=h.split(";");for(var r=[],o=h.length;o--;){var d=h[o];t.hasOwnProperty(d)&&r.push([d,"=",t[d]].join(""))}a="?"+r.join("&")}return s.push(" href='",(i.url||"")+a,"' class='",i.className||"","' target='",i.targets||"_self","' clickid='",i.click,"'>",e,"</a>"),s.join("")},image:function(t,i,e){var s=["<img"];s.push(" class='",i.className||"");var h=i.url,a=i.compare,r=i.relation,o=i.title,d=e;if("string"==typeof r)if(/\./.test(r)){var n=r.split(".");d=t[n[0]][n[1]]}else d=t[r];return o=o&&o[d]?o[d]:e,a&&(h=a[d]||h),s.push("' src='",h,"' title='",o,"' clickid='",i.click,"' />"),s.join("")},button:function(t,i,e){var s=["<button class='"];return s.push(i.className||"","' clickid='",i.click,"'>",i.value||e,"</button>"),s.join("")}},_init:function(){var i=this.options.datasource;"string"==typeof i&&"function"==typeof window[i]&&(this.options.datasource=window[i]);var e=this.options;this.el=e.el,this.el_cache=null,this.grid_container=null,this.grid_box=null,this.grid_style=null,this.grid_head=null,this.grid_head_table=null,this.grid_table_hide=null,this.grid_body=null,this.grid_table_box=null,this.grid_tbody=null,this.grid_scroll=null,this.grid_line=null,this.grid_empty=null,this.grid_tfoot=null,this.loading=null,this.grid_overlay=null,this.grid_all_check=null,this.create_dom_box=document.createElement("div"),this.dom_th=[],this.dom_tr=[],this.dom_td=[],this.dom_head_col=[],this.dom_body_col=[],this.thead_map=[],this.tr_frag=document.createElement("tbody"),this.data=[],this.backup_query=null,this.query=null,this.custom_query=null,this.row_size=0,this.col_size=0,this.thead_text=[],this.render_style=[],this.col_render=[],this.bind_name=[],this.num_col=0/0,this.spanrow=[],this.col_width=[],this.init_col_width=[],this.col_width_backup=[],this.multi_checked=[],this.multi_checked_num=0,this.single_checked=0/0,this.fixed_fn_click=[],this.col_hidden=[],this.total_size=0,this.guid="grid_"+t.guid(),this.height_light=[],this.grid_width=0,this.grid_height=0,this.table_width=0,this.thead_height=31,this.box_height=0,this.pagination_height=e.pagination?40:0,this.selectrows_html="",this.tds_package=[],this.render_complete=!1,this.odd=!1,this.un_render=!0,this.auto_height=!1,this.is_ittab=!1,this.arr_index=Array.prototype.indexOf,this.is_qm=t.Browser.isQM,this._backupQuery(),this._setPageSize(),this.__getDomTh(),this.__initWidthAndHeight()},_backupQuery:function(){var t=this.options,e={pageSize:t.pagesize,pageNo:t.pageno};this.backup_query=i.extend({},e),this.query=e},_setPageSize:function(){for(var t=this.options,i=this.query,e=t.pagesize_list,s=i.pageSize,h=e.length;h--;)if(s===e[h])return;i.pageSize=e[1]},__getDomTh:function(){var t,e,s,h=this.el;if(t=i(document.createElement("div")).html(["<table><thead>",h.find("thead").html()||h.find("tbody").html()||h.html(),"</thead></table>"].join("")).find("table").eq(0),this.el_cache=t,e=t.find("tr"),s=e.length,1===s){for(var a=t[0].getElementsByTagName("th"),r=[],o=0,d=a.length;d>o;o+=1)r.push(a[o]);this.dom_th=r}else{var n,l,_,c=this.thead_map=[];for(n=0;s>n;n+=1){var g=e.eq(n)[0],p=g.cells,u=p.length,f=0;for(c[n]||(c[n]=[]),l=0;u>l;l+=1){var m=p[l],v=m.colSpan;for(_=0;v>_;_+=1)c[n][f+_]=m;f+=v}var y=document.createElement("th");y.className="grid_empty_th",g.insertBefore(y,p[0])}for(n=0;s>n;n+=1){var b=c[n],w=b.length;for(l=0;w>l;l+=1){var k=b[l],x=k.rowSpan;for(_=n+1;x>_;_+=1)c[_][l]!==k&&c[_].splice(l,0,k)}}this.dom_th=i.extend([],c[s-1])}this.col_size=this.dom_th.length},__initWidthAndHeight:function(){var t=this.options,i="function"==typeof t.resizewidth?t.resizewidth():void 0,e="function"==typeof t.resizeheight?t.resizeheight():void 0;this.grid_width=(i||parseInt(t.gridwidth,10))-2;var s=t.gridheight;"auto"===s&&(s="500px",this.auto_height=!0),this.grid_height=(e||parseInt(s,10))-2,this.thead_height=31*this.el_cache.find("tr").length,this.box_height=this.grid_height-this.pagination_height-(t.titlelock?this.thead_height:0),this.table_width=t.adaptive?this.grid_width-17:parseInt(t.tablewidth,10)},_create:function(){this.__createLayoutDom(),this.__theadClickEventBind(),this.__theadMouseEventBind(),this.__tbodyClickEventBind(),this.__tbodyMouseEventBind(),this.__imitateScroll(),this._resizeEventBind(),this._setStyleWidth(),this._setStyleHeight(),this._loading("show"),this._createPropertys(),this._createContent();var t=this.options;"function"==typeof t.datasource&&t.datasource(this,this.getQuery())},__createLayoutDom:function(){var t=this.options,e=this.el,s=document.createElement("div");s.className="rowspagrid_container";var h=t.titlelock,a=['<div class="grid_box">'];h===!0?a.push('<div class="grid_head">','<table class="grid_head_table"></table>',"</div>",'<div class="grid_body">'):a.push('<div class="grid_body">','<div class="grid_head">','<table class="grid_head_table"></table>',"</div>"),a.push('<div class="grid_empty">\u672c \u5217 \u8868 \u6682 \u65e0 \u8bb0 \u5f55\uff01</div>','<div class="grid_table_box"><div class="grid_table_hide"></div></div>',"</div>",'<div class="grid_scroll">',"<div></div>","</div>",'<div class="grid_line"></div>','<div class="grid_overlay"></div>',"</div>",'<div class="grid_tfoot"></div>'),t.loadtip&&a.push("<div class='grid_loading_bg grid_loading_bg_over'></div><div class='grid_loading_box'><span>\u6b63\u5728\u52a0\u8f7d...</span></div>"),s.innerHTML=a.join(""),e[0].parentNode.insertBefore(s,e[0]);var r=this.grid_container=i(s).addClass(this.guid);this.is_qm&&r.addClass("rowspagrid_container_qm"),this.grid_table_box=i(".grid_table_box",r);var o=this.grid_box=r.children(".grid_box");this.grid_head=o.find(".grid_head").eq(0),this.grid_body=o.children(".grid_body").eq(0),this.grid_overlay=o.children(".grid_overlay").eq(0),this.grid_head_table=this.grid_head.children(".grid_head_table").eq(0),this.grid_line=o.children(".grid_line").eq(0),this.grid_scroll=o.children(".grid_scroll").eq(0),this.grid_tfoot=r.children(".grid_tfoot").eq(0),this.grid_empty=this.grid_body.children(".grid_empty").eq(0),this.loading=r.children(".grid_loading_bg").next().andSelf(),this.grid_table_hide=i(".grid_table_hide",r).eq(0).append(e.addClass("grid_body_table")),t.ellipsis&&e.addClass("grid_ellipsis"),t.titleellipsis&&this.grid_head_table.addClass("grid_ellipsis")},__theadClickEventBind:function(){var t=this.options,e=this;this.grid_head_table.on("click",function(s){s.stopPropagation();var h=s.target,a=h.className;if("grid_select"!==a&&"grid_ittab"!==a&&"grid_all_check"===a){var r=e.dom_tr,o=e.multi_checked,d="selected_row",n=e.row_size;if(i(h).prop("checked")){for(var l=n;l--;)o[l]=!0,i(r[l]).addClass(d).find("input").eq(0).prop("checked",!0);e.multi_checked_num=e.row_size}else{for(var _=n;_--;)o[_]=!1,i(r[_]).removeClass(d).find("input").eq(0).prop("checked",!1);e.multi_checked_num=0}var c=t.selectall_callback;if("function"==typeof c){var g=i(h).prop("checked");c.call(e,g?e.data:[],g)}}})},_thIndex:function(t){var i=this.dom_th,e=this.arr_index;if(e)return e.call(i,t);for(var s=this.col_size;s--;)if(i[s]===t)return s;return-1},__theadMouseEventBind:function(){this.grid_head_table.on("mouseover",function(t){var e=i(t.target),s=e.closest(".grid_fixed_s").eq(0);s.length&&s.parents("th").addClass("grid_thead_mouseover")}).on("mouseout",function(t){var e=i(t.target),s=e.closest(".grid_fixed_s").eq(0);s.length&&s.parents("th").removeClass("grid_thead_mouseover")})},__tbodyClickEventBind:function(){function t(t){if("no"!==a&&(r._selectRows(t,void 0),"function"==typeof s.rowclick_callback)){var i=!1;"multi"===a&&(i=r.multi_checked[t]),"single"===a&&(i=t===r.single_checked),s.rowclick_callback.call(r,r.data[t],i,t)}}var e,s=this.options,h="function"==typeof s.rowdblclick_callback?s.rowdblclick_callback:null,a=s.selectrows,r=this,o=null,d=null,n=s.checkboxname;r.el.on("click",function(s){if(s.stopPropagation(),d=s.target,e=d.tagName,"TBODY"!==e&&"TABLE"!==e&&!/grid_span/.test(d.className)){var a=i(d).closest("tr").eq(0),l=a.attr("index")||a[0].rowIndex-1,_=d.getAttribute("clickid")||"",c=new RegExp(e,"i");return c.test("a;button;img")?void(""!==_&&r.fixed_fn_click[_](r.data[l],l)):void(c.test("input")&&i(d).attr("name")!==n||(h?(clearTimeout(o),o=setTimeout(function(){t(l)},300)):t(l)))}}),r.el.on("dblclick",function(t){if(t.stopPropagation(),h){if(clearTimeout(o),d=t.target,e=d.tagName,"TBODY"===e||"TABLE"===e||/grid_span/.test(d.className))return;var s=i(d).closest("tr").eq(0),a=s.attr("index")-0;h.call(r,r.data[a],a)}})},_selectRows:function(t,e){var s=this.dom_tr,h=s[t],a=this.options,r=a.selectrows,o="selected_row",d=i(h);if("multi"===r){var n=this.multi_checked,l=n[t];if(void 0===e)e=l!==!0;else if(e===l)return;if(n[t]=e,!h)return;e===!1?(d.removeClass(o).children("td").find("input").prop("checked",!1),this.multi_checked_num--,this.grid_all_check.prop("checked",!1)):(d.addClass(o).children("td").find("input").prop("checked",!0),this.multi_checked_num+=1,this.multi_checked_num===this.row_size&&this.grid_all_check.prop("checked",!0))}else if("single"===r){var _=this.single_checked;if(this.single_checked=_===t&&e===!1?0/0:t,!h)return;e===!1?d.removeClass(o).children("td").eq(0).find("input").prop("checked",!1):(isNaN(_)||i(s[_]).removeClass(o),d.addClass(o).children("td").eq(0).find("input").prop("checked",!0))}},__tbodyMouseEventBind:function(){var t,e,s=this,h=this.bind_name,a=this.options.titlerender;s.el.on("mouseover",function(r){var o=r.target,d=o.tagName;if("TR"!==d&&"TBODY"!==d&&"TABLE"!==d){var n,l=i(o).closest("td"),_=l[0].cellIndex,c=l.find(".grid_fixed_s"),g=c.length?c:l,p=h[_];t&&t.removeClass("grid_tr_over"),t=l.closest("tr"),n=t.attr("index"),n||(n=t[0].rowIndex-1,t.attr("index",n)),/grid_span/.test(o.className)||t.addClass("grid_tr_over"),"number"==typeof p||l.attr("title")||("function"==typeof a?(e=a(s.data[n],p),e?l.attr("title",e):(e=g.html().replace(/<.*?>|\s+/g,""),e&&l.attr("title",e))):(e=g.html().replace(/<.*?>|\s+/g,""),e&&l.attr("title",e)))}})},__imitateScroll:function(){var t,i=this.grid_head_table[0],e=this.el[0];this.grid_scroll.on("scroll",function(){t="-"+this.scrollLeft+"px",i.style.marginLeft=t,e.style.marginLeft=t})},_resizeEventBind:function(){var t=this.options,e=this;(t.resizeheight||t.resizewidth)&&i(window).on("resize",function(){e.resize()})},resize:function(){var t=this.options;try{var i=t.resizeheight();"number"==typeof i&&i>0&&this._setHeight(i)}catch(e){}try{var s=t.resizewidth();"number"==typeof s&&s>0&&this.setWidth(s)}catch(e){}},_setStyleWidth:function(){this.grid_container.css("width",this.grid_width),this.el.css("width",this.table_width),this.grid_head_table.css("width",this.table_width)},_setStyleHeight:function(){this.grid_container.css("height",this.grid_height),this.grid_head.css("height",this.thead_height),this.grid_body.css("height",this.box_height)},_loading:function(t){this.options.loadtip&&(this.loading[t]().eq(0).css("height",this.grid_height),this.un_render&&"hide"===t&&this.grid_container.find(".grid_loading_bg").removeClass("grid_loading_bg_over"))},_createPropertys:function(){this.__getTagsPropertys(),this.__initColWidth()},_createContent:function(){this.__renderHead(),this.__renderBody(),this._setColWidthStyle(),this.__packageTds(),this._colHidden(!0),this.ittab._init(this);var t=this.options;t.colhidden&&this.hideCol._init(this),t.colmove&&0===this.thead_map.length&&this.moveCol._init(this)},__getTagsPropertys:function(){for(var t=this.dom_th,e=this.options,s=this.col_size,h=this.render_style,a=this.bind_name,r=this.thead_text,o=this.col_width,d=this.col_render,n=this.spanrow,l=this.fixed_fn_click,_=0;s>_;_+=1){var c=t[_];o.push(c.style.width||c.getAttribute("width")||""),this.col_hidden[_]="true"===c.getAttribute("hide")||"none"===i(c).css("display");var g=c.getAttribute("renderStyle")||"",p=g.replace(/padding.+?(;|$)/,"").replace(/display\s*?:\s*?none\s*?(;|$)/,"")+";";h.push(p);var u=c.getAttribute("bindName")||"";a[_]=u,isNaN(this.num_col)&&u.length&&!isNaN(u-0)&&(this.num_col=_,a[_]=u-0,u=""),n[_]="true"===c.getAttribute("spanrow"),r.push(c.innerHTML);var f=c.getAttribute("format"),m=e.colrender,v=c.getAttribute("render");if(d[_]=[],null!==f&&(/money/.test(f)?d[_][1]={format:Number(f.split("-")[1]||2),callback:this.format_fn.money}:/(dd|MM|yy)/i.test(f)&&(d[_][1]={format:f,callback:this.format_fn.date})),"function"==typeof m&&(d[_][0]={render:"colrender_fn",callback:m}),"string"==typeof v)if(new RegExp(v).test("a;button;image")){var y=c.getAttribute("options");if(null!==y)if(/{/.test(y))try{y=JSON.parse(y)}catch(b){y=new Function("return "+y+";")()}finally{"object"!=typeof y&&(y=void 0)}else y=window[y];if(y){var w=y.click;w="string"==typeof w?window[w]:w,y.click="function"==typeof w?l.push(w)-1:"",d[_][0]={render:"fiexd_fn",method:v,options:y}}}else{var k=window[v];if(k){var x={format:f||void 0,render:k,renderStyle:g,text:r[_]};d[_][0]={render:"render_fn",col_json:x,callback:k}}}}var z=e.selectrows;("multi"===z||"single"===z)&&(a[0]=-1)},__initColWidth:function(){for(var t=this.grid_width,e=this.table_width||t,s=this.col_width,h=this.col_width_backup,a=0,r=0,o=this.col_size,d=[],n=this.col_size;n--;){var l=s[n];h[n]=-1,""===l?(l=0,s[n]=200,d.push(n)):/%/.test(l)?(l=Math.round(e*parseInt(l,10)/100),s[n]=l):(l=parseInt(l,10),s[n]=l),a+=s[n],r+=l}var _=d.length,c=e-r;if(_>0&&c>_){for(var g=Math.round(c/_),p=0;_>p;p++)s[d[p]]=g;s[d[p-1]]+=c-g*_,this.table_width=e}else if(isNaN(this.table_width)&&a>=t)this.table_width=a;else{isNaN(this.table_width)&&(this.table_width=t);for(var u=[],f=0,m=0,v=o;v--;){var y=Math.round(s[v]*e/a);f+=y,u[v]=y,m=v}u[m]+=e-f,this.col_width=u}this.init_col_width=i.extend([],this.col_width)},__renderHead:function(){var e=this.options,s=this.dom_th,h=this.thead_map,a=this.thead_map.length,r=this.dom_head_col,o=this.thead_text,d=this.col_size,n=this.options.colhidden,l=document.createElement("tr"),_=e.ellipsis;if(l.className="grid_width_norm",a){var c=document.createElement("th");c.className="grid_empty_th",l.appendChild(c);for(var g=a-1;g--;)for(var p=h[g],u=p.length;u--;){var f=p[u];f.removeAttribute("width"),f.style.width=""}}for(var m=0;d>m;m+=1){var v=r[m]=document.createElement("th");l.appendChild(v);var y=s[m];y.removeAttribute("width"),y.style.width="";var b=o[m],w=['<div class="grid_fixed_d">','<span class="grid_fixed_s">','<a class="grid_thead_text'];_&&!/</.test(b)&&w.push('" title="',b),w.push('">',b,"</a>"),n&&w.push('<a class="grid_select"></a>'),w.push('<em class="grid_ittab"></em>'),w.push("</span>"),w.push("</div>"),y.innerHTML=w.join("")}this.grid_head_table.html(this.el_cache.find("thead").eq(0).prepend(l)),this.el_cache.parent().remove(),delete this.el_cache;var k=i(s[0]);if("multi"===e.selectrows){k.find(".grid_select").eq(0).remove(),k.find(".grid_fixed_s").addClass("grid_no_move");var x=i(s[0]).find(".grid_thead_text").addClass("grid_all_check_box"),z=x.find("input")[0],C=document.createElement("input");(this.is_qm||t.Browser.isIE7||t.Browser.isIE6)&&x.addClass("grid_all_check_box_qm"),C.type="checkbox",C.name=e.allboxname,C.className="grid_all_check",x[0].replaceChild(C,z);var N=document.createElement("i");N.className="grid_null_text",N.innerHTML="&nbsp;",x[0].appendChild(N),this.grid_all_check=x.find(".grid_all_check")}"single"===e.selectrows&&(k.find(".grid_select").eq(0).remove(),k.find(".grid_fixed_s").addClass("grid_no_move"))},__renderBody:function(){var t=this.el,i=this.col_size,e=this.dom_body_col,s=document.createElement("tr");s.className="grid_width_norm";for(var h=0;i>h;h+=1){var a=e[h]=document.createElement("th");s.appendChild(a)}t.html("<thead></thead><tbody></tbody>"),t.find("thead").append(s),this.grid_tbody=t.find("tbody").eq(0)},__packageTds:function(){var t=this.options,i=this.render_style,e=t.selectrows,s=this.selectrows_html={no:"",multi:"<input type='checkbox' name='"+t.checkboxname+"' />",single:"<input type='radio' name='"+t.checkboxname+"' />"}[e],h=this.col_size,a=[],r=0;if(""!==s){r+=1;var o=a[0]={};o.style=i[0],o.html=s}for(var d=r;h>d;d+=1){var n=a[d]={};n.style=i[d]}this.tds_package=a},_setColWidth:function(t){for(var i=this.init_col_width,e=this.col_hidden,s=this.table_width,h=this.col_size,a=0,r=h;r--;)e[r]===!1&&(a+=i[r]);for(var o=[],d=0,n=0,l=h;l--;)if(e[l]===!1){var _=Math.round(i[l]*s/a);d+=_,o[l]=_,n=l}else o[l]=0;o[n]+=s-d,this.col_width=o,this._setColWidthStyle(),t&&this._isScrolling(!0)},_setColWidthStyle:function(t){var i,e=this.col_width,s=this.dom_head_col,h=this.dom_body_col,a=this.col_size,r="";if("number"==typeof t)i=e[t]-1+"px",s[t].style.width=i,h[t].style.width=i;else for(;a--;)r=0===e[a]?0:e[a]-1+"px",s[a].style.width=r,h[a].style.width=r},_colHidden:function(t){for(var i=this.row_size,e=this.dom_th,s=this.dom_td,h=this.tds_package,a=this.dom_head_col,r=this.dom_body_col,o=this.col_hidden,d=this.col_width,n=this.col_width_backup,l=this.table_width,_=this.thead_map,c=null,g=[],p=!1,u=null,f=this.col_size;f--;)if(o[f]===!0){if(-1===n[f]||t){if(a[f].style.display="none",u=e[f],u.style.display="none",_.length){g=[u],p=!1;for(var m=_.length-1;m--;){c=_[m][f];for(var v=g.length;v--;)if(g[v]===c){p=!0;break}p||(g.push(c),c.colSpan>1?c.colSpan--:c.style.display="none")}}for(var y=i;y--;)s[y][f].style.display="none";r[f].style.display="none",h[f].style+="display:none;",n[f]=d[f],l-=d[f],d[f]=0}}else if(-1!==n[f]){if(a[f].style.display="",u=e[f],u.style.display="",_.length){g=[u],p=!1;for(var b=_.length-1;b--;){c=_[b][f];for(var w=g.length;w--;)if(g[w]===c){p=!0;break}p||(g.push(c),"none"===c.style.display?c.style.display="":c.colSpan+=1)}}for(var k=i;k--;)s[k][f].style.display="";r[f].style.display="",h[f].style=h[f].style.replace(/display.*?($|;)/g,""),d[f]=n[f],l+=n[f],n[f]=-1}this.options.adaptive?this.is_ittab=!1:this.table_width=l,this._setLayout()},_isScrolling:function(t){var i=this.el,e=this.grid_width+2,s=this.table_width,h=this.box_height,a=i.height(),r=this.grid_scroll;this.options.adaptive&&!this.is_ittab?(a>h?(s=this.table_width=e-17,r.css("width",e-17)):(this.table_width=e,s=e+1,r.css("width","")),i.css("width",s),this.grid_head_table.css("width",s),r.css("left","-999999px"),t||(this._setColWidth(!0),this._setLayout(!0))):(a>h&&e>=s+17&&(this.grid_table_hide.css("marginBottom",0),r.css("left","-999999px")),s>e&&h>=a+17&&(r.css({width:"",left:0}).children("div").eq(0).css("width",s-1),this.grid_table_hide.css("marginBottom",17)),(s+17>e&&a>h||s>e&&a+17>h)&&(r.css({width:e-17,left:0}).children("div").eq(0).css("width",s),this.grid_table_hide.css("marginBottom",17)),h>=a&&e>=s&&(this.grid_table_hide.css("marginBottom",0),r.css("left","-999999px"))),r[0].scrollLeft=Math.max(r[0].scrollLeft-1,0)},_setAutoHeight:function(){var t,i=27;if(this.auto_height){t=this.grid_table_box;var e=parseInt(t.css("marginBottom"),10)||0,s=Math.max(t.height()||this.row_size*i,i);this._setHeight(s+e+this.thead_height+(this.options.pagination?40:0)+2)}},_setLayout:function(t){this._setStyleWidth(),(!this.options.titleellipsis||this.thead_map.length)&&this._setTheadHeight(),this._setStyleHeight(),t||this._isScrolling(),this._setAutoHeight()},_setTheadHeight:function(){this.grid_head.css("height","auto");var t=this.thead_height=this.grid_head.height();this.box_height=this.grid_height-this.pagination_height-(this.options.titlelock?t:0)},setDatasource:function(t,e){t=t||[],e=e||0,this.row_size=t.length,this.data=i.extend(!0,[],t),this.options.pagination&&(this.un_render&&(this.total_size=e,this.__createPagination()),this.total_size!==e&&(this.total_size=e,this._changepages())),this._isEmpty(),this._initProperty(),this._renderTbody(),this._setLayout(),this._loading("hide"),this._loadComplateCallBack(),delete this.un_render},_isEmpty:function(){var t=this.options,i=this.row_size;0===i?(this.grid_empty.show(),this.grid_tfoot.hide(),this.el.hide(),this.pagination_height=0):(this.grid_empty.hide(),this.el.show(),t.pagination&&(this.grid_tfoot.show(),this.pagination_height=40)),this.box_height=this.grid_height-this.pagination_height-(t.titlelock?this.thead_height:0)},_initProperty:function(){this.dom_tr=[],this.dom_td=[],this.multi_checked=[],this.multi_checked_num=0,this.single_checked=0/0,this.odd=!1,this.render_complete=!1,this.grid_all_check&&this.grid_all_check.prop("checked",!1),this.grid_tbody.html("")},loadData:function(){this._loading("show"),this.options.datasource(this,this.getQuery())},__createPagination:function(){var t=this.options,i=this.query;if(t.pagination){var e=this;window.cui(this.grid_tfoot).pagination({count:this.total_size,pagesize:i.pageSize,pageno:i.pageNo,pagesize_list:t.pagesize_list,tpls:{pagination:t.pagination_model},cls:t.pagination_model,on_page_change:function(t,s){i.pageNo=t,i.pageSize=s,e.loadData(),e._changepages()}}),this.pagination_obj=window.cui(this.grid_tfoot)}},_changepages:function(){var t=this.query;this.pagination_obj.setInitData({count:this.total_size,pagesize:t.pageSize,pageno:t.pageNo}),this.pagination_obj.reDraw()},_spliceArray:function(t,i,e){return Array.prototype.splice.apply(t,[i,0].concat(e)),t},_renderTbody:function(){this._appendRows(0,this.row_size)},_loadComplateCallBack:function(){var t=this.options.loadcomplate_callback;"function"==typeof t&&t.call(this)},_dataToDom:function(t,i,e){function s(t,i){return['rowspan="',i-0+1,'"'].join("")}for(var h,a=this.options,r="cardinal_row",o=a.oddevenrow,d=this.col_size,n=this.dom_th,l=this.tds_package,_=this.bind_name,c=this.spanrow,g=this.num_col,p=a.render_span,u=this.col_render,f=a.colstylerender,m="function"==typeof f,v=this.render_method,y=this.height_light,b=""!==this.selectrows_html?1:0,w=this.odd,k=a.primarykey,x="object"==typeof t[0]&&t[0].hasOwnProperty(k),z=this.create_dom_box,C=[],N=[],q=["<table>"],B=i;e>B;B+=1){h=['<tr class="'],o&&(w&&h.push(r),w=!w),y[B]&&h.push(" grid_highlight"),h.push('"');var S=t[B];if(x&&S.hasOwnProperty(k)&&h.push(' pkey="',String(S[k]),'"'),h.push(">"),q.push(h.join("")),1===b){var A=l[0],E=['<td class="grid_select_input'];E.push('" style="',A.style,'">',A.html,"</td>"),q.push(E.join(""))}for(var T,j="",H="",I="",P="",L="",D="",M=null,R=null,V=null,W=null,O=b;d>O;O+=1){if(I=_[O],j=l[O],P=g===O?B+I:I?S[I]:"",L=P,M=u[O],R=M[0],V=M[1],V&&(P=V.callback(P,V.format)||P),R)switch(D=R.render){case"colrender_fn":P=R.callback(S,I)||P;break;case"render_fn":W=R.col_json,W.el=n[O],W.bindName=I,P=R.callback(S,B,W)||P;break;case"fiexd_fn":P=v[R.method](S,R.options,P)||P}var Q=j.style;if(m&&(H=f(S,I),"string"==typeof H&&(Q+=";"+H)),c[O])if(L=p?P:L,C[O]===L){var X=(d+2)*N[O]+O+2;q[X]=q[X].replace(/rowspan="(\d+)"/,s),T=['<td style="',Q,'" class="grid_span grid_span_none">',P,"</td>"]}else C[O]=L,N[O]=B,T=['<td style="',Q,'" rowspan="1" class="grid_span">',P,"</td>"];else T=['<td style="',Q,'">',P,"</td>"];C[O]=L,q.push(T.join(""))}q.push("</tr>")}this.odd=w,q.push("</table>"),z.innerHTML=q.join("");for(var K=[],Y=[],$=z.getElementsByTagName("table")[0],G=0,U=e-i;U>G;G+=1){var F=$.rows[G];K.push(F);for(var J=[],Z=0;d>Z;Z+=1)J.push(F.cells[Z]);Y.push(J)}return{dom_td:Y,dom_tr:K}},_appendRows:function(t,i){var e=this.row_size;this.auto_height&&(i=e);var s=this._dataToDom(this.data,t,i);this.dom_tr=this.dom_tr.concat(s.dom_tr),this.dom_td=this.dom_td.concat(s.dom_td);for(var h=this.dom_tr,a=this.grid_tbody[0],r=t;i>r;r+=1)a.appendChild(h[r]);this.grid_table_box.css("paddingBottom",27*(e-i)),this.render_complete=i===e,this.append_rows_complete=!0,this._setAutoHeight()},hideCols:function(t){if("object"===i.type(t)){for(var e=this.col_hidden,s=this.col_size,h=this.bind_name,a=0;s>a;a+=1){var r=t[h[a]];"boolean"==typeof r&&(e[a]=r)}this._colHidden(!1)}},getQuery:function(){var t=i.extend(!0,{},this.query),e=this.custom_query;return e?(e.pageSize=t.pageSize,e.pageNo=t.pageNo,e):t},setQuery:function(t){"object"==typeof t&&(this.custom_query=t),t=t||this.backup_query;var i=this.query;"number"==typeof t.pageSize&&(i.pageSize=t.pageSize),"number"==typeof t.pageNo&&(i.pageNo=t.pageNo),this._setPageSize(),this.pagination_obj&&this._changepages()},_setHeight:function(t){return"number"!=typeof t||t-2===this.grid_height?!1:(t-=2,this.box_height-=this.grid_height-t,this.grid_height=t,this._lazyload(),this.options.colhidden&&this.hideCol.hide_col&&this.hideCol.hide_col.blur(),!0)},setHeight:function(t){this.auto_height=!this._setHeight(t),this._setLayout()},setWidth:function(t){if("number"==typeof t&&t-2!==this.grid_width){var i=this.ittab;i&&i.ittab_active||(t-=2,this.options.adaptive&&(this.table_width=t-17,this.is_ittab=!1),this.grid_width=t,this._setLayout(),this.options.colhidden&&this.hideCol.hide_col&&this.hideCol.hide_col.blur())}},selectRowsByIndex:function(t,i){i=i!==!1;var e,s,h=this.options.selectrows,a=this.data,r=[];if("no"===h||t>=this.row_size)return[];if(i!==!1&&(i=!0),"number"==typeof t&&(t=[t]),"single"===h)e=t[0],this._selectRows(e,i),r.push(a[e]);else for(var o=0,d=t.length;d>o;o+=1)s=t[o],this._selectRows(s,i),r.push(a[s]);return r},_pkToIndex:function(t,e){"array"!==i.type(t)&&(t=[t]);var s=this.data,h=this.row_size,a=this.options.primarykey;if(s[0].hasOwnProperty(a)===!1)return[];for(var r=t.length,o=[],d=0;r>d;d+=1){for(var n=t[d],l=!1,_=h;_--;)if(s[_][a]===n){o.push(_),l=!0;break}!l&&e&&o.push(-1)}return o},selectRowsByPK:function(t,i){var e=this.options;return"no"!==e.selectrows&&this.row_size&&this.data[0].hasOwnProperty(e.primarykey)!==!1?this.selectRowsByIndex(this._pkToIndex(t,!0),i):[]},getData:function(){return i.extend(!0,[],this.data)},getSelectedRowData:function(){var t=this.options.selectrows;if("no"===t)return[];var i=this.data;if("single"===t)return[i[this.single_checked]];if(this.multi_checked_num===this.row_size)return this.data;for(var e=this.multi_checked,s=this.row_size,h=[],a=0;s>a;a+=1)e[a]&&h.push(i[a]);return h},getSelectedPrimaryKey:function(){var t=this.options,i=t.selectrows,e=t.primarykey,s=this.getSelectedRowData(),h=s.length;if("no"===i||!h||s[0].hasOwnProperty(e)===!1)return[];for(var a=[],r=0;h>r;r+=1)a.push(s[r][e]);return a},getSelectedIndex:function(){var t=this.options.selectrows;if("no"===t)return[];if("single"===t)return[this.single_checked];for(var i=this.multi_checked,e=this.row_size,s=[],h=0;e>h;h+=1)i[h]&&s.push(h);return s},getRowsDataByIndex:function(t){var e=this.data;if("number"==typeof t)return[e[t]];if("array"===i.type(t)){for(var s=t.length,h=[],a=0;s>a;a+=1){var r=e[t[a]];r&&h.push(r)}return h}},getRowsDataByPK:function(t){var e=this.options.primarykey,s=this.data;if(s[0].hasOwnProperty(e)){"array"!==i.type(t)&&(t=[t]);for(var h=t.length,a=[],r=0;h>r;r+=1)for(var o=t[r],d=this.row_size;d--;)if(s[d][e]===o){a.push(s[d]);break}return a}return null},_switchCol:function(t,e){var s=this.dom_head_col,h=this.dom_body_col,a=this.dom_td,r=this.dom_th,o=this.dom_tr,d=this.num_col;this._switchArrayValue(this.bind_name,t,e),this._switchArrayValue(this.spanrow,t,e),this._switchArrayValue(this.thead_text,t,e),this._switchArrayValue(this.render_style,t,e),this._switchArrayValue(this.col_render,t,e),this._switchArrayValue(this.col_width,t,e),this._switchArrayValue(this.init_col_width,t,e),this._switchArrayValue(this.col_width_backup,t,e),this._switchArrayValue(this.col_hidden,t,e),this._switchArrayValue(this.tds_package,t,e),isNaN(d)||(t===d?this.num_col=e-(t>e?0:1):t>d&&d>=e?this.num_col=d+1:d>t&&e>d&&(this.num_col=d-1));var n=null,l=this.row_size,_=this.hideCol,c=_.dom_a,g=_.grid_hidecol_list;if(e===this.col_size){var p=i(r[t]);p.appendTo(p.parent());var u=i(h[t]);u.appendTo(u.parent());var f=i(s[t]);for(f.appendTo(f.parent());l--;)n=a[l],o[l].appendChild(n[t]),this._switchArrayValue(n,t,e);g&&g.appendChild(""!==this.selectrows_html?c[t-1]:c[t])}else{for(i(r[t]).insertBefore(r[e]),i(h[t]).insertBefore(h[e]),i(s[t]).insertBefore(s[e]);l--;)n=a[l],o[l].insertBefore(n[t],n[e]),this._switchArrayValue(n,t,e);g&&(""!==this.selectrows_html?g.insertBefore(c[t-1],c[e-1]):g.insertBefore(c[t],c[e]))}this._switchArrayValue(r,t,e),this._switchArrayValue(h,t,e),this._switchArrayValue(s,t,e)},_switchArrayValue:function(t,i,e){t.length<e&&(t[e]=void 0),i>e?t.splice(e,0,t.splice(i,1)[0]):t.splice(e-1,0,t.splice(i,1)[0])},ittab:{ittab_active:!1,_init:function(t){var e=this,s=t.grid_overlay,h=t.grid_line,a=[],r=0,o=0,d=!0,n=0/0,l=t.options.adaptive;t.grid_head_table.find(".grid_ittab").show(),t.grid_head_table.on("mousedown",function(e){var l=e.target;if(o=0,"grid_ittab"===l.className){a=t.col_width,n=t._thIndex(i(l).parents("th")[0]),s.show().css("cursor","col-resize");var _=s.offset().left;r=e.pageX-_,h.show().css("left",r),d=!1,s.off("mousemove").on("mousemove",function(t){return t.stopPropagation(),o=t.pageX-_,a[n]+o-r<24&&(o=24+r-a[n]),h.css("left",o),!1})}return!1}),s.on("mouseup mouseout",function(){if(!d&&!isNaN(n)&&(d=!0,i(this).hide(),h.hide(),0!==o)){var s=o-r;t.is_ittab=!0,t.col_width[n]=a[n]+s,t.table_width=t.table_width+s,e.ittab_active=!0,t._setColWidthStyle(l?void 0:n),t._setLayout(),e.ittab_active=!1,r=o=0,n=0/0}})}},hideCol:{_init:function(t){var e=this.hide_col=document.createElement("div");e.className="grid_hidecol";var s=t.thead_height;e.style.top=s+"px",e.tabIndex="1",t.grid_container.append(e),e=i(e);var h=t.col_size,a=t.thead_text,r=0;""!==t.selectrows_html&&(r+=1);for(var o=['<div class="grid_hidecol_list" hidefocus="true" >'];h>r;r+=1)o.push('<a href="javascript:;" hidefocus="true" title=',a[r],'><input type="checkbox" checked="checked" />',a[r],"</a>");o.push("</div>",'<div class="grid_hidecol_button">','<a href="javascript:;" hidefocus="true" class="grid_hidecol_confirm">\u786e\u5b9a</a>','<a href="javascript:;" hidefocus="true" class="grid_hidecol_cancel">\u53d6\u6d88</a>',"</div>"),e.html(o.join("")),this.grid_hidecol_list=e.find(".grid_hidecol_list")[0],this.dom_a=this.grid_hidecol_list.getElementsByTagName("a"),this.bindEvent(t,e)},bindEvent:function(t,e){function s(){for(var t=n;h>t;t+=1)l.eq(t-n).prop("checked",p[t]!==!0)}var h=t.col_size,a=t.grid_box.offset().left,r=a+t.grid_width/2,o=null,d=!1,n=0,l=e.find("input"),_=-1,c=this.dom_a,g=document.createElement("span");""!==t.selectrows_html&&(n+=1),t.grid_head_table.on("click",function(p){var u=p.target;if("grid_select"===u.className){o&&e.blur(),l=e.find("input"),o=i(u).parents("th").addClass("grid_thead_select");var f=i(u).offset().left,m=f-a+2;f>r&&(m-=126);var v=Math.max(t.box_height-t.thead_height-40,60);22*h>v?e.children(".grid_hidecol_list").css("height",v):e.children(".grid_hidecol_list").css("height",""),e.css({left:m,top:t.thead_height}).show().focus().attr("hidefocus","true"),s();var y=t._thIndex(o[0])-n;c[y].appendChild(g),l.eq(_).removeAttr("disabled").end().eq(y).attr("disabled","disabled"),_=y,d=!1}else i(e).blur()}),e.on("blur",function(){d||(o&&o.removeClass("grid_thead_select"),i(e).hide())}),e.on("mouseover",function(){d=!0}),e.on("mouseout",function(){d=!1});var p=t.col_hidden;e.on("click",function(e){var a=i(e.target),r=a.prop("className"),o=a.prop("tagName"),_=a.children("input").eq(0);if("grid_hidecol_confirm"===r){for(var c=n;h>c;c+=1)p[c]=l.eq(c-n).prop("checked")===!1;return d=!1,t._colHidden(!1),i(this).blur(),!1}return"grid_hidecol_cancel"===r?(s(),d=!1,i(this).blur(),!1):"A"===o?(_.prop("disabled")||_.prop("checked",!_.prop("checked")),!1):void this.focus()}),setTimeout(s,100)}},moveCol:{_init:function(t){var e=i("<div></div>"),s=i("<div></div>"),h=t.grid_head_table.addClass("grid_col_move");e.addClass("grid_col_move_insert"),s.addClass("grid_col_move_tag"),t.grid_head.append(s).append(e);
var a=t.options,r=t.grid_overlay,o=t.selectrows_html,d=null,n=[],l=[],_=0/0,c=0/0,g=!0;h.on("mousedown",function(p){var u=i(p.target);if(u.hasClass("grid_fixed_s")&&!u.hasClass("grid_no_move")){a.colhidden&&t.hideCol.hide_col.blur(),g=!1,d=t.col_hidden;var f=t.col_width,m=t.col_size,v=t.dom_th,y=Math.round(h.offset().left),b=t.grid_scroll[0].scrollLeft,w=0,k=t.thead_height,x=u.parent().parent();_=t._thIndex(x[0]),n=[],l=[];var z,C=null,N=0,q=0;for(z=0;m>z;z+=1)C=f[z],N=Math.round(i(v[z]).offset().left)-y-b,d[z]===!0&&(N=-100),n.push(N),l.push(N),d[z]||(l[z]=N+C/2);n.push(t.table_width-b),l.push(t.table_width-b-1),o&&(n[0]=l[0]=-100),q=n[_]-1,s.show().css({left:q,width:x.width(),height:k,lineHeight:k+"px"}).html(u.find(".grid_thead_text").eq(0).html()),e.show().css("height",k-4),r.show().css("cursor","move");var B=p.pageX;e.css("left",-1e3),r.off("mousemove").on("mousemove",function(t){t.stopPropagation(),w=t.pageX,s.css("left",q-B+w);for(var i=l.length,h=0;i>h;h+=1){var a=l[h];if(!(0>a)&&a>w){e.css("left",n[h]),c=h;break}}return!1})}}),r.on("mouseup",function(){if(!g&&(g=!0,r.hide(),e.hide(),s.hide(),!isNaN(c)&&!isNaN(_)&&c!==_&&c!==_+1)){if(_>c)return t._switchCol(_,c),void(c=_=0/0);for(var i=_+1;c>i;i+=1)if(!d[i]){t._switchCol(_,c),c=_=0/0;break}}}),r.on("mouseout",function(){r.hide(),e.hide(),s.hide(),c=_=0/0})}}})}(window.comtop);